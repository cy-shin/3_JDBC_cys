<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE properties SYSTEM "http://java.sun.com/dtd/properties.dtd">
<properties>
	<comment>admin-query.xml file</comment>

	<!-- 키워드로 검색 -->
	<entry key = 'keywordSearch'>
		SELECT CALL_NO, TOPIC, BOOK_NAME, AUTHOR, PUBLISHER, LOC, AVAIL, NVL(TO_CHAR(DUE_DATE,'YYYY-MM-DD'),'-') DUE_DATE
		FROM TB_BOOKS
		JOIN TB_TOPIC USING (TOPIC_CODE)
		JOIN TB_LOCATION USING (LOC_CODE)
		JOIN TB_AVAILABILITY USING (AVAIL_CODE)
		WHERE BOOK_NAME = ?
		OR AUTHOR = ?
		OR PUBLISHER = ?
	</entry>
	
	<entry key ='searchAll'>
		SELECT BOOK_NO, CALL_NO, TOPIC, BOOK_NAME, AUTHOR, PUBLISHER, LOC, AVAIL, NVL(TO_CHAR(DUE_DATE,'YYYY-MM-DD'),'-') DUE_DATE
		FROM TB_BOOKS
		JOIN TB_TOPIC USING (TOPIC_CODE)
		JOIN TB_LOCATION USING (LOC_CODE)
		JOIN TB_AVAILABILITY USING (AVAIL_CODE)
	</entry>
	
	<entry key ="searchOverdue">
	
		<![CDATA[
			SELECT REC_NO, BOOK_NO, REC.CALL_NO, BOOK_NAME, USER_NO, USER_NAME,
			TO_CHAR(LENT_DATE, 'YYYY-MM-DD') LENT_DATE, 
			TO_CHAR(REC.DUE_DATE, 'YYYY-MM-DD') DUE_DATE,
			NVL(TO_CHAR(RETURN_DATE, 'YYYY-MM-DD'), '-') RETURN_DATE
			FROM TB_LENT_RECORD REC
			JOIN TB_BOOKS USING(BOOK_NO)
			JOIN TB_USER USING(USER_NO)
			WHERE SYSDATE > REC.DUE_DATE
			AND RETURN_DATE IS NULL
			ORDER BY REC_NO DESC
		]]>	
	</entry>
	
	<!-- 청구기호로 검색 -->
	<entry key = 'bookInfo'>
		SELECT CALL_NO, TOPIC, BOOK_NAME, AUTHOR, PUBLISHER, LOC, AVAIL, NVL(TO_CHAR(DUE_DATE,'YYYY-MM-DD'),'-') DUE_DATE
		FROM TB_BOOKS
		JOIN TB_TOPIC USING (TOPIC_CODE)
		JOIN TB_LOCATION USING (LOC_CODE)
		JOIN TB_AVAILABILITY USING (AVAIL_CODE)
		WHERE CALL_NO = ?
	</entry>
	
	<!-- ReturnBook  -->
	<entry key = "returnBook">
		UPDATE TB_BOOKS
		SET DUE_DATE = NULL,
			AVAIL_CODE = 'PL'
		WHERE BOOK_NO = ?
	</entry>
	
	<!-- ReturnLentRec  -->
	<entry key = "returnLentRec">
		UPDATE TB_LENT_RECORD
		SET RETURN_DATE = SYSDATE
		WHERE BOOK_NO = ?
		AND RETURN_DATE IS NOT NULL
	</entry>
	
	
</properties>
